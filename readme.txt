
从网络上下载的代码

本人意见如下:
1、代码逻辑可供参考.
2、内核版本要求比较高(linux-2.6.35以上, linux-2.6.35上似乎有修改说明)。
3、spiOpend变量似起不到作用, 或者不能严格进行同步.
4、需要的对kfifo接口作美容性修改
5、已成功移植到TQ2440上, SPI时间满足要求(需要研究其实现原理)
6、已成功移植到mini2440上, 可在调试中看到发出的数据与中断里收到的数据相同.
7、两端都可看到, /cs(GPG14)与/int(GPG13)可以正常发出信号。
8、至此，应用层可正常收发数据(2012-02-29 17:02:05).
9、可通过命令动态创建应用层的设备结点2012-03-22 11:22:55
10、2012-03-27 20:30:10测试代码的乱序问题彻底解决 
11、2012-03-31 11:10:45 应用层全速发收数据正常 
12、2012-04-09 14:45:06 三种控制场景全完成. 但遥控场景需要验证
13、2012-06-18 16:13:37 白名单导入ok
14、2012-06-18 17:08:47 白名单可正常拦截
15、2012-06-25 19:04:12 验收屏蔽ok. 可准确发往某个适配器 
16、2012-07-06 14:34:32 遥控功能初步可用
17、2012-07-21 14:47:52 复查发现，设定的125kbps的速率实际上是167kbps. 偿试改成125kbps 
18、2012-08-22 19:02:08 双向遥控 
19、2012-08-24 17:11:58 将定时轮询整理到内核线程中，便于同步. 增加对一些指针的初始化
20、2012-08-25 14:24:36 将0x11命令的长度修改成8字节, 0x12命令检查CRC
21、2012-08-28 15:46:53 待发送命令存入kfifo, 内核线程取kfifo中的数据并发送.下一步考虑内核线程只取kfifo中的数据，其它的向kfifo存入数据的过程在tasklet中实现  
22、2012-08-29 11:50:21 命令0x43改成12字节, 最后一个字节是CRC, 多出的几个系无效数据 
23、2012-08-30 17:57:26 内核线程发送完canbus数据的条件是，缓冲区没有数据，并且出错计数清零。
24、2012-09-06 09:28:34 全面更新命令格式，所有的命令全都以以下形式出现: destAddr(4byte)+srcAddr(4byte)+Version(1byte)+reserved-1(1byte)+cmd/data(4+)+reserved-2(0+)+CRC(1byte)其中的只是为了凑足一个canbus帧满8个byte而加上去的, 不是必须的。
25、2012-09-08 15:31:54 整理两个自旋锁的使用canLock和sndfifoLock。 
26、2012-09-10 19:36:13 发送数据只用一个mcp2510发送缓冲区 
27、2012-09-19 18:05:10 将写入白名单的过程中，创建设备数据区的代码删除(删除前发现严重故障，后来发现应该接口松动造成的，但不能确定此代码是否安全)。设备文件名由白名单中的指定名称和次设备号组合而成，其中最后一个数据是次设备号 
28、2012-09-20 15:10:10 节点数据区的导出换成seq_file接口.
29、2012-09-22 20:24:48 修改轮询及定时策略，初始化后，必须将所有的转接卡轮询一遍之后(这之前只能发0x11、0x13指令数据, 用于查询设备及相应处理)才能发正常的数据.
30、2012-09-24 09:39:44 进一步完善轮询及定时策略。

31、2012-12-20 09:41:30 开始加入电力载波兼容功能.2012-12-20 19:49:30 完成，要求canbus-x10转换器发出设备存在的信息
32、2012-12-24 15:49:52 将地址长度改为2byte. 第3byte用作协议号
33、2012-12-25 11:24:01 已可正常生成不同主设备号的设备节点，读写操作正常。命令仍用0x41/0x42/0x43
34、2012-12-26 17:13:38 可对x10灯光进行开关、亮度调节。
2012-12-29 11:11:30 修正多次发送设定/查询命令的故障(系预先设定一非法值作为初始值，将其与收到的值比较，必然不相等。因此而重发数据)。
2012-12-30 10:14:25 初步加入mcp2510的直接操作接口,待完善此接口功能.
2012-12-30 17:16:20 加入mcp2510的直接操作接口，待验证。同时x10操作正常
2012-12-31 15:39:18 原始数据写入到canbus可行. 将此接口的发送数据后轮询的时间间隔设为10s
2013-01-04 16:18:31 解析conf_file文件时，加入对空白行的识别.
2013-01-09 17:21:54 mcp2510的raw数据接口导出
2013-01-10 10:05:07 中断部分采用参数形式传递host相关参数. 对host参数更多地使用参数引入, 函数中使用局部变量
2013-01-12 15:29:01 加了一个测试脚本
2013-01-14 15:59:28 在ioctl中添加版本查询功能
2014-05-06 10:20:11 stub不再处理。复制httpPage到~/tftpboot目录下;修正目录
2014-05-08 18:39:59 httpPage目录中确定有可用的文件huarain.x10.cgi/index.html
2014-05-14 08:48:57 去掉light文件夹及其中数据
2014-05-21 14:27:12 重新整理需要用到的脚本文件的位置.
2014-05-22 18:12:23 整理lockBy315M部分内容
2014-05-29 16:59:44 已实现同时控制x10设备(灯光)和RF315M设备(锁)。(zigbee遥控作为控制命令的发出端一直可用)
2014-06-04 17:12:36 可通过2440上的http网页正常控制x10的灯和315M的指纹锁。也可通过转发服务器中转到2440上，然后由2440控制x10的灯和315M的指纹锁
2014-07-07 16:38:53 修改connect上的远端控制协议，完成client/host部分(未验证)
2014-07-09 11:47:53 修改connect上的远端控制协议.可以转发并整合(待2440验证). 已验证可以控制x10模块
2014-08-29 12:04:06 修改connServer转发服务器上的问题。
2014-12-11 18:03:14 实现网络登录设置ip, 长按K1按键10s恢复ip原始设置
